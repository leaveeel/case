# 过程


公司后面会有个需求，需要可以搜索的下拉搜索框功能，让我去找找插件，因为之前也用jqery分别写过两个简单的模拟select和搜索功能的demo，就想着合并一下，整合完了以后因为jquery版本过高（2.x），在ie8浏览器里不兼容，换了百度静态资源库1.7.1老版本成功实现，觉得有些限制，就想着转成原生代码。写了一半后想到可以用object写个插件类的js，毕竟还没写过，尝试一下，故而放弃了单纯的操控dom和页面调用方法。起初编写很顺利，有一些小的障碍比如ie8不支持classList，操控class较为麻烦，而元素的显示隐藏是用class来控制的，就需要获取className的字符串进行匹配增加/删除，当最初没有className的时候控制台一直报错，虽然不影响功能但看着很烦，就取巧用style控制等。最终在死数据的情况下也成功实现了。而在接下来改用异步获取数据的时候就头疼了，原生的ajax方法根本没接触过，但看了文档也能取得数据，但获取的是字符串类型，不能继续匹配属性，这里看了好多文档最后通过百度的Function方法解决，又用到了构造函数。这部分处理完了就剩下取数据赋值生成dom了，最后成功实现功能。但现在所有代码都在一个js里，还是要读代码修改参数等等。于是就想把数据通过外部传入变量来获取，修改了相应的关键字，然后问题来了，找不到对象。因为js文件放在了head里，为了让标签能正确填充用了onload，而script标签在body底部，因此之前在js文件内模拟的调用函数传关键字等等都失效了，还不死心的换着方法试了几遍。后来发现可以在onload外面创建一个全局对象，然后在内部调用数据，试了一下可以实现，就创建了一个function，在外部定义了四个变量，想通过html调用function将json数据的文件名，数据流，属性名，值传到object内的XMLHttpRequest里，前两个都很顺利，在获取属性名和值的时候因为获取方法为xxx.name，这个name要是我传入的变量，拼接成字符串以后又不知道怎么把他整体转成一个变量，这边也试了一会放弃了function的方法，改用创建一个object2，把整个获取拼接数据部分提取到html文件里，用function方式传回js内的这个object2，然后用onload里的object调用。这时又出现一个问题，创建的object2内部有三个属性，dom，list，function，在页面内需要从function内获取到json数据转成字符串形式传到list内，然后在object中调用object2.list并做接下来的一系列事件绑定等动作，而在html页面内的赋值成功了，在object内能打印出来但获取不到，为此又换了很多方式，调整list位置，调整获取位置，更换赋值方法等，又消耗了一大笔时间，原因在于后获取的数据有很小的延迟，能够在打印的详细里看到但是在主干的list里还是为空，给获取list和随后的绑定用setTimeout设置一个短暂的延迟就可以了。至此整个功能算是结束了，所有数据操作在html文件获取，操作在js内部实现，XMLHttpRequest在html文件里还有个好处就是可以随意修改做为option的元素结构，不局限于单个参数，这是我最开始写js的时候没想到的。还有下拉框里的副标题等等功能估计也懒得优化了，思路是给option加个class区分，修改一下有关[li]的标识让他在正确的数据上触发。<br />
js文件里注释部分是完全写在js里的代码。这里还没删，不过之前的调试，最初的jquery等等就没有了。这也算是我的第一个轮子吧，自行车轮也是轮。在<a href="../">case</a>目录里有<a href="../模拟select.html">模拟select</a>和<a href="../搜索框筛选.html">input搜索</a>的jquery demo
